define(["require","jquery"],function(require){var jQuery=require("jquery"),$=jQuery;jQuery.extend({handleError:function(e,t,n,r){e.error&&e.error.call(e.context||e,t,n,r),e.global&&(e.context?jQuery(e.context):jQuery.event).trigger("ajaxError",[t,e,r])},createUploadIframe:function(e,t){var n="jUploadFrame"+e;if(window.ActiveXObject){var r=document.createElement("iframe");r.setAttribute("id",n),r.setAttribute("name",n),typeof t=="boolean"?r.src="javascript:false":typeof t=="string"&&(r.src=t)}else{var r=document.createElement("iframe");r.id=n,r.name=n}return r.style.position="absolute",r.style.top="-1000px",r.style.left="-1000px",document.body.appendChild(r),r},createUploadForm:function(e,t){var n="jUploadForm"+e,r="jUploadFile"+e,i=$('<form  action="" method="POST" name="'+n+'" id="'+n+'" enctype="multipart/form-data"></form>'),s=$("#"+t),o=$(s).clone(!0);return $(s).attr("id",r),$(s).before(o),$(s).appendTo(i),$(i).css("position","absolute"),$(i).css("top","-1200px"),$(i).css("left","-1200px"),$(i).appendTo("body"),i},ajaxFileUpload:function(e){e=jQuery.extend({},jQuery.ajaxSettings,e);var t=(new Date).getTime(),n=jQuery.createUploadForm(t,e.fileElementId),r=jQuery.createUploadIframe(t,e.secureuri),i="jUploadFrame"+t,s="jUploadForm"+t;e.global&&!(jQuery.active++)&&jQuery.event.trigger("ajaxStart");var o=!1,u={};e.global&&jQuery.event.trigger("ajaxSend",[u,e]);var a=function(t){var r=document.getElementById(i);try{r.contentWindow?(u.responseText=r.contentWindow.document.body?r.contentWindow.document.body.innerHTML:null,u.responseXML=r.contentWindow.document.XMLDocument?r.contentWindow.document.XMLDocument:r.contentWindow.document):r.contentDocument&&(u.responseText=r.contentDocument.document.body?r.contentDocument.document.body.innerHTML:null,u.responseXML=r.contentDocument.document.XMLDocument?r.contentDocument.document.XMLDocument:r.contentDocument.document)}catch(s){jQuery.handleError(e,u,null,s)}if(u||t=="timeout"){o=!0;var a;try{a=t!="timeout"?"success":"error";if(a!="error"){var f=jQuery.uploadHttpData(u,e.dataType);e.success&&e.success(f,a),e.global&&jQuery.event.trigger("ajaxSuccess",[u,e])}else jQuery.handleError(e,u,a)}catch(s){a="error",jQuery.handleError(e,u,a,s)}e.global&&jQuery.event.trigger("ajaxComplete",[u,e]),e.global&&!--jQuery.active&&jQuery.event.trigger("ajaxStop"),e.complete&&e.complete(u,a),jQuery(r).unbind(),setTimeout(function(){try{$(r).remove(),$(n).remove()}catch(t){jQuery.handleError(e,u,null,t)}},100),u=null}};e.timeout>0&&setTimeout(function(){o||a("timeout")},e.timeout);try{var n=$("#"+s);$(n).attr("action",e.url),$(n).attr("method","POST"),$(n).attr("target",i),n.encoding?n.encoding="multipart/form-data":n.enctype="multipart/form-data",$(n).submit()}catch(f){jQuery.handleError(e,u,null,f)}return window.attachEvent?document.getElementById(i).attachEvent("onload",a):document.getElementById(i).addEventListener("load",a,!1),{abort:function(){}}},uploadHttpData:function(r,type){var data=!type;return data=type=="xml"||data?r.responseXML:r.responseText,type=="script"&&jQuery.globalEval(data),type=="json"&&(data=data.replace('<pre style="word-wrap: break-word; white-space: pre-wrap;">',""),data=data.replace("</pre>",""),eval("data = "+data)),type=="text/plain"&&(data=data.replace('<pre style="word-wrap: break-word; white-space: pre-wrap;">',""),data=data.replace("<pre>",""),data=data.replace("</pre>",""),data=data.replace(/\\/g,"\\\\"),eval("data = "+data)),type=="html"&&jQuery("<div>").html(data).evalScripts(),data}})});
